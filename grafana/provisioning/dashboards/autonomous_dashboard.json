{
	"id": null,
	"uid": "somabrain-autonomous",
	"title": "Somabrain â€¢ Cognitive Thread",
	"tags": ["somabrain", "cog"],
	"timezone": "",
	"schemaVersion": 39,
	"version": 1,
	"refresh": "10s",
	"editable": true,
	"graphTooltip": 0,
	"time": {
		"from": "now-1h",
		"to": "now"
	},
	"templating": {
		"list": [
			{
				"name": "ds",
				"type": "datasource",
				"query": "prometheus",
				"label": "Datasource",
				"current": {},
				"hide": 0
			},
			{
				"name": "tenant",
				"label": "Tenant",
				"type": "query",
				"datasource": "$ds",
				"query": "label_values(somabrain_integrator_leader_entropy, tenant)",
				"refresh": 1,
				"hide": 0,
				"includeAll": true,
				"multi": true,
				"current": {}
			},
			{
				"name": "topic",
				"label": "Outbox Topic",
				"type": "query",
				"datasource": "$ds",
				"query": "label_values(somabrain_outbox_event_e2e_seconds, topic)",
				"refresh": 1,
				"hide": 0,
				"includeAll": true,
				"multi": true,
				"current": {}
			}
		]
	},
	"panels": [
		{
			"type": "stat",
			"title": "Leader Switches (r/s)",
			"gridPos": {"x": 0, "y": 0, "w": 8, "h": 4},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "sum(rate(somabrain_integrator_leader_switches_total{tenant=~\"$tenant\"}[5m]))",
					"legendFormat": "switches/s",
					"refId": "A"
				}
			]
		},
		{
			"type": "stat",
			"title": "Tau (softmax temperature)",
			"gridPos": {"x": 8, "y": 0, "w": 8, "h": 4},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "avg(somabrain_integrator_tau)",
					"legendFormat": "tau",
					"refId": "A"
				}
			]
		},
		{
			"type": "timeSeries",
			"title": "Leader Entropy (0..1) by tenant",
			"gridPos": {"x": 16, "y": 0, "w": 8, "h": 8},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "histogram_quantile(0.5, sum by (le, tenant) (rate(somabrain_integrator_leader_entropy_bucket{tenant=~\"$tenant\"}[5m])))",
					"legendFormat": "{{tenant}} p50",
					"refId": "A"
				},
				{
					"expr": "histogram_quantile(0.9, sum by (le, tenant) (rate(somabrain_integrator_leader_entropy_bucket{tenant=~\"$tenant\"}[5m])))",
					"legendFormat": "{{tenant}} p90",
					"refId": "B"
				}
			]
		},
		{
			"type": "timeSeries",
			"title": "Segments Emitted (by evidence)",
			"gridPos": {"x": 0, "y": 4, "w": 12, "h": 8},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "sum by (evidence) (rate(somabrain_segments_emitted_total[5m]))",
					"legendFormat": "{{evidence}}",
					"refId": "A"
				}
			]
		},
		{
			"type": "timeSeries",
			"title": "Dwell at Boundaries (ms)",
			"gridPos": {"x": 12, "y": 4, "w": 12, "h": 8},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "histogram_quantile(0.9, sum(rate(somabrain_segments_dwell_ms_bucket[5m])) by (le))",
					"legendFormat": "p90",
					"refId": "A"
				},
				{
					"expr": "histogram_quantile(0.5, sum(rate(somabrain_segments_dwell_ms_bucket[5m])) by (le))",
					"legendFormat": "p50",
					"refId": "B"
				}
			]
		},
		{
			"type": "timeSeries",
			"title": "Predictor Emits (r/s)",
			"gridPos": {"x": 0, "y": 12, "w": 12, "h": 8},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "rate(somabrain_predictor_state_emitted_total[5m])",
					"legendFormat": "state",
					"refId": "A"
				},
				{
					"expr": "rate(somabrain_predictor_agent_emitted_total[5m])",
					"legendFormat": "agent",
					"refId": "B"
				},
				{
					"expr": "rate(somabrain_predictor_action_emitted_total[5m])",
					"legendFormat": "action",
					"refId": "C"
				}
			]
		},
		{
			"type": "timeSeries",
			"title": "Outbox E2E Latency (s)",
			"gridPos": {"x": 12, "y": 12, "w": 12, "h": 8},
			"datasource": "$ds",
			"targets": [
				{
					"expr": "histogram_quantile(0.9, sum by (le) (rate(somabrain_outbox_event_e2e_seconds_bucket{topic=~\"$topic\"}[5m])))",
					"legendFormat": "p90",
					"refId": "A"
				},
				{
					"expr": "histogram_quantile(0.5, sum by (le) (rate(somabrain_outbox_event_e2e_seconds_bucket{topic=~\"$topic\"}[5m])))",
					"legendFormat": "p50",
					"refId": "B"
				}
			]
		}
	]
}

