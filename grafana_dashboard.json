{
  "annotations": {},
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "iteration": 1620000000000,
  "links": [],
  "panels": [
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "id": 1,
      "options": {},
      "targets": [
        {
          "expr": "rate(somabrain_http_requests_total{job=\"$target\"}[1m]) * 60",
          "legendFormat": "Requests per minute",
          "refId": "A"
        }
      ],
      "title": "Request Rate",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "id": 2,
      "options": {},
      "targets": [
        {
          "expr": "(rate(somabrain_http_latency_seconds_sum[5m]) / rate(somabrain_http_latency_seconds_count[5m])) * 1000",
          "legendFormat": "Avg latency (ms)",
          "refId": "A"
        }
      ],
      "title": "Average Latency",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "custom": {}
        },
        "overrides": []
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
      "id": 3,
      "options": {},
      "targets": [
        {
          "expr": "somabrain_wm_utilization",
          "legendFormat": "WM Utilization",
          "refId": "A"
        }
      ],
      "title": "Working Memory Utilization",
      "type": "gauge"
    },
    {
      "datasource": "Prometheus",
      "type": "stat",
      "title": "Uptime",
      "gridPos": {"h":4,"w":6,"x":0,"y":16},
      "options": {"reduceOptions": {"calcs":["lastNotNull"]}},
      "targets": [{"expr":"up{job=\"$target\"}","legendFormat":"","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "stat",
      "title": "Store Events",
      "gridPos": {"h":4,"w":6,"x":6,"y":16},
      "options": {"reduceOptions": {"calcs":["lastNotNull"]}},
      "targets": [{"expr":"somabrain_store_events_total{job=\"$target\"}","legendFormat":"","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "stat",
      "title": "Recall Success",
      "gridPos": {"h":4,"w":6,"x":12,"y":16},
      "options": {"reduceOptions": {"calcs":["lastNotNull"]}},
      "targets": [{"expr":"(somabrain_recall_cache_hit_total{job=\"$target\"}) / (somabrain_recall_cache_hit_total{job=\"$target\"} + somabrain_recall_cache_miss_total{job=\"$target\"})", "legendFormat":"","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "heatmap",
      "title": "Latency Distribution (p95)",
      "gridPos": {"h":8,"w":12,"x":0,"y":20},
      "options": {"heatmap": {"color": {"mode": "spectrum"}}},
      "targets": [{"expr":"histogram_quantile(0.95, sum(rate(somabrain_http_latency_seconds_bucket{job=\"$target\"}[5m])) by (le)","legendFormat":"p95","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "gauge",
      "title": "Dopamine",
      "gridPos": {"h":4,"w":6,"x":12,"y":20},
      "options": {},
      "targets": [{"expr":"somabrain_neuromod_dopamine{job=\"$target\"}","legendFormat":"","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "gauge",
      "title": "Serotonin",
      "gridPos": {"h":4,"w":6,"x":18,"y":20},
      "options": {},
      "targets": [{"expr":"somabrain_neuromod_serotonin{job=\"$target\"}","legendFormat":"","refId":"A"}]
    },
    {
      "datasource": "Prometheus",
      "type": "gauge",
      "title": "Noradrenaline",
      "gridPos": {"h":4,"w":6,"x":24,"y":20},
      "options": {},
      "targets": [{"expr":"somabrain_neuromod_noradrenaline{job=\"$target\"}","legendFormat":"","refId":"A"}]
    }
  ],
  "refresh": "5s",
  "schemaVersion": 30,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "name": "target",
        "type": "custom",
        "label": "Server",
        "hide": 0,
        "default": "somabrain_dev",
        "options": [
          { "text": "dev (9696)", "value": "somabrain_dev" },
          { "text": "prod (9696)", "value": "somabrain_prod" }
        ],
        "current": { "text": "dev (9696)", "value": "somabrain_dev" },
        "includeAll": false,
        "multi": false,
        "query": "",
        "refresh": 1
      }
    ]
  },
  "time": {"from": "now-1h", "to": "now"},
  "timepicker": {},
  "timezone": "",
  "title": "SomaBrain Core Metrics",
  "uid": "somabrain-core",
  "version": 1,
  "weekStart": ""
}
