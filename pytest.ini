[pytest]
env =
    REDIS_HOST=127.0.0.1
    REDIS_PORT=6379
    SOMABRAIN_HOST=127.0.0.1
    SOMABRAIN_PORT=9696
    SOMABRAIN_MEMORY_HOST=127.0.0.1
    SOMABRAIN_MEMORY_PORT=9596
    KAFKA_HOST=127.0.0.1
    KAFKA_PORT=9092
    OPA_HOST=127.0.0.1
    OPA_PORT=8181
    POSTGRES_HOST=127.0.0.1
    POSTGRES_PORT=15432
    SOMABRAIN_ALLOW_FAKEREDIS=1
    SOMABRAIN_STRICT_REAL=1
    SOMABRAIN_FORCE_FULL_STACK=1
    SOMABRAIN_REQUIRE_MEMORY=1
# Consolidated marker definitions – duplicate sections cause pytest to raise an
# error. All markers are listed under a single ``markers`` key.
markers =
    dev: run tests in dev mode (default)
    strict: run tests with strict‑real mode enabled
    full: run tests with full‑stack mode enabled
    integration: mark tests as integration (requires external services like Redis/Kafka/OPA)
    learning: mark tests that validate live adaptation/learning behavior

# Run only the recall‑related tests (and the direct health check) to avoid
# importing modules that depend on unavailable external services.
# Run only the recall integration test; the direct TestClient health test
# interferes with background tasks in the full app and is not required for the
# recall‑quality objective.
; Removed an overly restrictive -k filter so newly added unit tests are not
; silently deselected. Use -k on the command line to selectively run tests
; when needed (e.g. `pytest -k test_recall`). The pytest_asyncio plugin is
; still enabled by default below.
addopts = -ra -q -p pytest_asyncio
testpaths = tests
filterwarnings =
    ignore::DeprecationWarning
