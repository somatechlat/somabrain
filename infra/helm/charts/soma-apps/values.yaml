global:
  imagePullPolicy: IfNotPresent
  namespace: "somabrain"
  sharedInfraNamespace: "soma"

featureFlags:
  enableCogThreads: false

sb:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  service:
    type: ClusterIP
    port: 9696
    targetPort: 9696
  containerPort: 9696
  testService:
    enabled: false
    # ClusterIP test service port exposed inside the cluster for CI/load tests
    port: 9999
    targetPort: 9696
  ingress:
    enabled: false
  env: {}

sa01:
  enabled: true
  image:
    repository: ghcr.io/somatech/sa01
    tag: latest
  replicaCount: 1
  service:
    type: ClusterIP
    port: 50051
    targetPort: 50051
  containerPort: 50051
  env: {}

sah:
  enabled: true
  image:
    repository: ghcr.io/somatech/sah
    tag: latest
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8081
    targetPort: 8081
  containerPort: 8081
  env: {}

smf:
  enabled: true
  image:
    repository: ghcr.io/somatech/smf
    tag: latest
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8082
    targetPort: 8082
  containerPort: 8082
  env: {}

envCommon:
  # Memory endpoint is provisioned outside this chart; override as needed.
  SOMABRAIN_MEMORY_HTTP_ENDPOINT: ""
  SOMABRAIN_REDIS_URL: "redis://soma-infra-redis-master.soma.svc.cluster.local:6379/0"
  SOMABRAIN_KAFKA_URL: "kafka://soma-infra-kafka:9092"
  SOMABRAIN_POSTGRES_DSN: "postgresql://postgres:postgres@soma-postgres.svc.cluster.local:5432/somabrain"
  SOMABRAIN_OPA_URL: "http://soma-infra-opa.soma.svc.cluster.local:8181"

# Cognitive thread microservices
integrator:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "250m"
      memory: "256Mi"
  env:
    SOMABRAIN_FF_COG_INTEGRATOR: "1"
    ENABLE_COG_THREADS: "1"
    SOMA_COMPAT: "1"

segmentation:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "250m"
      memory: "256Mi"
  env:
    SOMABRAIN_FF_COG_SEGMENTATION: "1"
    ENABLE_COG_THREADS: "1"
    SOMABRAIN_SEGMENT_MODE: "leader"
    SOMABRAIN_SEGMENT_MAX_DWELL_MS: "0"
    # CPD mode tuning (used when SOMABRAIN_SEGMENT_MODE=cpd)
    SOMABRAIN_CPD_MIN_SAMPLES: "20"
    SOMABRAIN_CPD_Z: "4.0"
    SOMABRAIN_CPD_MIN_GAP_MS: "1000"
    SOMABRAIN_CPD_MIN_STD: "0.02"
    # Hazard/HMM mode tuning (used when SOMABRAIN_SEGMENT_MODE=hazard)
    SOMABRAIN_HAZARD_LAMBDA: "0.02"
    SOMABRAIN_HAZARD_VOL_MULT: "3.0"
    SOMABRAIN_HAZARD_MIN_SAMPLES: "20"

predictorState:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "25m"
      memory: "48Mi"
    limits:
      cpu: "200m"
      memory: "192Mi"
  env:
    SOMABRAIN_FF_PREDICTOR_STATE: "1"
    ENABLE_COG_THREADS: "1"
    SOMA_COMPAT: "1"

predictorAgent:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "25m"
      memory: "48Mi"
    limits:
      cpu: "200m"
      memory: "192Mi"
  env:
    SOMABRAIN_FF_PREDICTOR_AGENT: "1"
    ENABLE_COG_THREADS: "1"
    SOMA_COMPAT: "1"

predictorAction:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "25m"
      memory: "48Mi"
    limits:
      cpu: "200m"
      memory: "192Mi"
  env:
    SOMABRAIN_FF_PREDICTOR_ACTION: "1"
    ENABLE_COG_THREADS: "1"
    SOMA_COMPAT: "1"

orchestrator:
  enabled: true
  image:
    repository: ghcr.io/somatech/somabrain
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "250m"
      memory: "256Mi"
  env:
    SOMABRAIN_FF_COG_ORCHESTRATOR: "1"
    ENABLE_COG_THREADS: "1"

prometheus:
  podMonitor:
    enabled: false
    interval: 30s
  rules:
    enabled: false
    # Alert thresholds
    frames_absent_minutes: 5
    segments_absent_minutes: 5
    leader_switches_rate_threshold: 0.2   # switches/sec
    outbox_p90_seconds_threshold: 2.0

autoscaling:
  enabled: false
  # Default HPA targets (override per component if needed)
  cpu:
    targetAverageUtilization: 70
  minReplicas: 1
  maxReplicas: 3

podDisruptionBudget:
  enabled: false
  minAvailable: 1

networkPolicy:
  enabled: false
