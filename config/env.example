# SomaBrain Environment Template
#
# Copy this file to `.env` (or export the variables manually) to run the
# stack locally. Values are safe defaults for development; override them per
# environment as needed.

## Core infrastructure --------------------------------------------------------
SOMABRAIN_POSTGRES_DSN=postgresql://somabrain:somabrain@127.0.0.1:5432/somabrain
SOMABRAIN_REDIS_URL=redis://127.0.0.1:6379/0
SOMABRAIN_KAFKA_URL=127.0.0.1:30102
SOMABRAIN_MEMORY_HTTP_ENDPOINT=http://127.0.0.1:9595
SOMABRAIN_MEMORY_HTTP_TOKEN=
SOMABRAIN_HTTP_MAX_CONNS=64
SOMABRAIN_HTTP_KEEPALIVE=32
SOMABRAIN_HTTP_RETRIES=1

## Authentication -------------------------------------------------------------
SOMABRAIN_JWT_SECRET=
SOMABRAIN_JWT_PUBLIC_KEY_PATH=
SOMABRAIN_DISABLE_AUTH=0

## Enforcement & feature flags -----------------------------------------------
SOMABRAIN_REQUIRE_EXTERNAL_BACKENDS=1
SOMABRAIN_ALLOW_BACKEND_FALLBACKS=0
SOMABRAIN_ALLOW_BACKEND_AUTO_FALLBACKS=0
SOMABRAIN_FORCE_FULL_STACK=1
SOMABRAIN_REQUIRE_MEMORY=1
SOMABRAIN_MINIMAL_PUBLIC_API=0
SOMABRAIN_PREDICTOR_PROVIDER=mahal
SOMABRAIN_MODE=enterprise

## Memory client configuration -----------------------------------------------
SOMABRAIN_MEMORY_ENABLE_WEIGHTING=0
SOMABRAIN_MEMORY_PHASE_PRIORS=
SOMABRAIN_MEMORY_QUALITY_EXP=1.0
SOMABRAIN_MEMORY_FAST_ACK=0
MEMORY_DB_PATH=./data/memory.db
SOMABRAIN_DOCKER_MEMORY_FALLBACK=

## OPA -----------------------------------------------------------------------
SOMABRAIN_OPA_URL=http://127.0.0.1:8181
SOMA_OPA_TIMEOUT=2.0
SOMA_OPA_FAIL_CLOSED=0

## Miscellaneous --------------------------------------------------------------
SOMABRAIN_LEARNING_LOOP_ENABLED=0
SOMABRAIN_LEARNING_RATE_DYNAMIC=0
SOMABRAIN_DEBUG_MEMORY_CLIENT=0
SOMABRAIN_ALLOW_LOCAL_MIRRORS=1
SOMABRAIN_DEFAULT_TENANT=sandbox

# Optional overrides for scripting or helper tools
SOMABRAIN_AUTH_SERVICE_URL=
SOMABRAIN_AUTH_SERVICE_API_KEY=
SOMABRAIN_TENANT=

## Kafka dual-listener (optional dev overrides) -----------------------------
# Host port mapped to EXTERNAL listener in docker-compose
KAFKA_BROKER_HOST_PORT=30102
# EXTERNAL listener container port (INTERNAL stays on 9092)
KAFKA_BROKER_EXTERNAL_CONTAINER_PORT=9094
KAFKA_CFG_NODE_ID=1
KAFKA_CFG_PROCESS_ROLES=broker,controller
KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@somabrain_kafka:9093
KAFKA_CFG_LISTENERS=INTERNAL://0.0.0.0:9092,EXTERNAL://0.0.0.0:9094,CONTROLLER://0.0.0.0:9093
KAFKA_CFG_ADVERTISED_LISTENERS=INTERNAL://somabrain_kafka:9092,EXTERNAL://localhost:${KAFKA_BROKER_HOST_PORT}
KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL
KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT
KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=true
KAFKA_CFG_NUM_PARTITIONS=2
KAFKA_CFG_DEFAULT_REPLICATION_FACTOR=1
KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_CFG_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_CFG_TRANSACTION_STATE_LOG_MIN_ISR=1
KAFKA_CFG_LOG_DIRS=/var/lib/kafka/data
KAFKA_CFG_LOG_RETENTION_MS=604800000
KAFKA_CFG_LOG_SEGMENT_BYTES=52428800
KAFKA_CFG_LOG_RETENTION_BYTES=536870912
KAFKA_CFG_COMPRESSION_TYPE=snappy
KAFKA_HEAP_OPTS=-Xmx384m -Xms256m
KAFKA_CLUSTER_ID=79LccNO-Qe6G6YgqP1Zrew
